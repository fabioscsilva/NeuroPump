<%= form_for(@appointment_plan) do |f| %>
<% if @appointment_plan.errors.any? %>
<div id="error_explanation">
	<h2><%= pluralize(@appointment_plan.errors.count, "error") %> prohibited this appointment_plan from being saved:</h2>

	<ul>
		<% @appointment_plan.errors.full_messages.each do |msg| %>
		<li>
			<%= msg %>
		</li>
		<% end %>
	</ul>
</div>
<% end %>

<style type="text/css">
	#div1 {
		width: 600px;
		height: 100px;
		padding: 10px;
		border: 1px solid #aaaaaa;
	}

	#div2 {
		width: 600px;
		height: 100px;
		padding: 10px;
		border: 1px solid #FF0000;
	}
</style>

<script>
	var list = new Array("", "", "", "", "");

	function allowDrop(ev) {
		ev.preventDefault();
	}

	function drag(ev) {
		ev.dataTransfer.setData("Text", ev.target.id);
	}

	function drop(ev) {
		ev.preventDefault();
		var data = ev.dataTransfer.getData("Text");
		if (ev.target.id == "div1" || ev.target.id == "div2") {
			document.getElementById(ev.target.id).appendChild(document.getElementById(data));
		} else {
			var copy_to = $('#' + ev.target.id).clone(true);
			$('#' + ev.target.id).replaceWith($("#" + data).clone(true));
			$('#' + data).replaceWith(copy_to);
		}

	}

	function final(val) {
		var elms = document.getElementById("div2").childNodes;
		var input = [];
		for (var i = 0; i < elms.length; i++) {
			if (elms[i].id != undefined)
				input.push(elms[i].id);
		}

		if (val == 1) {
			$.post('/appointment_plans', {
				'testList' : input,
				'appoitmentID' : $('#appID').val()
			}, function(data, statusText) {
				window.location.href = "/appointments";
			});

		} else if (val == 2) {
			$.ajax({
				type : 'PUT',
				url : '/appointment_plans/' + $('#appID').val(),
				data : {
					'testList' : input,
					'appoitmentID' : $('#appID').val()
				},
				success : function(data) {
					window.location.href = "/appointments";
				}
			});
		}
	}
</script>

<p>
	Arraste a imagem para o retangulo:
</p>

<div id="div1" ondrop="drop(event)" ondragover="allowDrop(event)">
	<%= @testes.html_safe %>
</div>
</br>
</br>
</br>

<div id="div2" ondrop="drop(event)" ondragover="allowDrop(event)">
	<% @appoitment_plan.each do |app_test| %>
		<img id="<%= app_test.evaluation_test.name%>" src="/assets/<%= app_test.evaluation_test.name%>.png" draggable="true" ondragstart="drag(event)" width="100" height="100">
	<% end %>
</div>

<input id="appID" type="hidden" value="<%= params[:appID] %>" />

<% if @appoitment_plan.empty? %>
<button type="button" onclick="final(1)">
	Criar
</button>
<% else %>
<button type="button" onclick="final(2)">
	Editar
</button>
<% end %>
<!--
<div class="actions">
<%= f.submit %>
</div> -->
<% end %>
