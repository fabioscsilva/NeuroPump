<%= form_for(@appointment_plan) do |f| %>
<% if @appointment_plan.errors.any? %>
<div id="error_explanation">
	<h2><%= pluralize(@appointment_plan.errors.count, "error") %> prohibited this appointment_plan from being saved:</h2>

	<ul>
		<% @appointment_plan.errors.full_messages.each do |msg| %>
		<li>
			<%= msg %>
		</li>
		<% end %>
	</ul>
</div>
<% end %>

<style type="text/css">
	#div1 {
		width: 387px;
		height: 225px;
		padding: 10px;
		border: 1px solid #aaaaaa;
		margin-left: -20px;
	}

	#div2 {
		width: 382px;
		height: 225px;
		padding: 10px;
		border: 2px dashed black;
	}
</style>

<script>
	var list = new Array("", "", "", "", "");

	function allowDrop(ev) {
		ev.preventDefault();
	}

	function drag(ev) {
		ev.dataTransfer.setData("Text", ev.target.id);
	}

	function drop(ev) {
		ev.preventDefault();
		var data = ev.dataTransfer.getData("Text");
		if (ev.target.id == "div1" || ev.target.id == "div2") {
			document.getElementById(ev.target.id).appendChild(document.getElementById(data));
		} else {
			var copy_to = $('#' + ev.target.id).clone(true);
			$('#' + ev.target.id).replaceWith($("#" + data).clone(true));
			$('#' + data).replaceWith(copy_to);
		}

	}

	function final(val) {

		var elms = document.getElementById("div2").childNodes;
		var input = [];
		for (var i = 0; i < elms.length; i++) {
			if (elms[i].id != undefined)
				input.push(elms[i].id);
		}

		if (val == 1) {
			$.post('/appointment_plans', {
				'testList' : input,
				'appoitmentID' : $('#appID').val()
			}, function(data, statusText) {
				window.location.href = "/appointment_plans/"+$('#appID').val();
			});

		} else if (val == 2) {
			$.ajax({
				type : 'PUT',
				url : '/appointment_plans/' + $('#appID').val(),
				data : {
					'testList' : input,
					'appoitmentID' : $('#appID').val()
				},
				success : function(data) {
					window.location.href = "/appointment_plans/"+$('#appID').val();
				}
			});
		}
	}
</script>

<div class="row-fluid">
	<span> Arraste os testes desejados (caixa da esquerda) para a caixa da direita: </span>
	<br>
	<br>
</div>

<div class="span12 row-fluid">
	<div id="div1" class="span5" ondrop="drop(event)" ondragover="allowDrop(event)">
		<%= @testes.html_safe %>
	</div>
	<div class="span1" style="margin-top: 88px;">
		<button id="btImg" class="btn btn-primary">
			<i class="icon icon-backward icon-white"></i>
			<br>
			<i class="icon icon-forward icon-white"></i>
		</button>
	</div>
	<div id="div2" class="span5 pull-left" ondrop="drop(event)" ondragover="allowDrop(event)">
		<% @appoitment_plan.each do |app_test| %>
		<img id="<%= app_test.evaluation_test.name%>" src="/assets/<%= app_test.evaluation_test.name%>.png" draggable="true" ondragstart="drag(event)" width="100" height="100">
		<% end %>
	</div>

	
</div>

<input id="appID" type="hidden" value="<%= params[:appID] %>" />

	<div class="span12 pull-right" style="margin-top: 20px;">
		<% if @appoitment_plan.empty? %>
		<button type="button" onclick="final(1)" class="btn btn-primary pull-right">
			Criar
		</button>
		<% else %>
		<button type="button" onclick="final(2)" class="btn btn-primary pull-right">
			Gravar
		</button>
		<% end %>
	</div>

<% end %>
